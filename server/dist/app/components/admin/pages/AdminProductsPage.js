import { jsx as _jsx, jsxs as _jsxs, Fragment as _Fragment } from "react/jsx-runtime";
import { useState, useMemo } from "react";
import { Plus, Search, Filter, Edit2, Trash2, ChevronLeft, ChevronRight, Download, Package, Eye, EyeOff } from "lucide-react";
import { useAdmin } from "../AdminContext";
import { useConfirm } from "../ConfirmModal";
import { categories, formatPrice } from "../../data";
import { ProductModal } from "../ProductModal";
export function AdminProductsPage() {
    const { products, deleteProduct, updateProduct, addProduct } = useAdmin();
    const { confirm } = useConfirm();
    // State for filters
    const [search, setSearch] = useState("");
    const [category, setCategory] = useState("all");
    const [stockStatus, setStockStatus] = useState("all");
    const [activeFilter, setActiveFilter] = useState("all"); // "all", "active", "inactive"
    const [showFilters, setShowFilters] = useState(false);
    // State for pagination
    const [page, setPage] = useState(1);
    const itemsPerPage = 8;
    // State for Modal
    const [isModalOpen, setIsModalOpen] = useState(false);
    const [editingProduct, setEditingProduct] = useState(null);
    // Filter logic
    const filteredProducts = useMemo(() => {
        return products.filter(p => {
            const matchSearch = p.name.toLowerCase().includes(search.toLowerCase()) ||
                p.sku.toLowerCase().includes(search.toLowerCase());
            const matchCategory = category === "all" || p.category === category;
            const matchStock = stockStatus === "all" || p.stockStatus === stockStatus;
            const matchActive = activeFilter === "all" ||
                (activeFilter === "active" && p.isActive !== false) ||
                (activeFilter === "inactive" && p.isActive === false);
            return matchSearch && matchCategory && matchStock && matchActive;
        });
    }, [products, search, category, stockStatus, activeFilter]);
    const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
    const currentProducts = filteredProducts.slice((page - 1) * itemsPerPage, page * itemsPerPage);
    const handleDelete = async (id, name) => {
        const ok = await confirm({
            title: "Eliminar Producto",
            message: `¿Estás seguro que deseas eliminar "${name}"? Esta acción no se puede deshacer.`,
            confirmLabel: "Eliminar",
            cancelLabel: "Cancelar",
            variant: "danger"
        });
        if (ok) {
            deleteProduct(id);
        }
    };
    const handleOpenCreate = () => {
        setEditingProduct(null);
        setIsModalOpen(true);
    };
    const handleOpenEdit = (product) => {
        setEditingProduct(product);
        setIsModalOpen(true);
    };
    const handleSave = (productData) => {
        if (editingProduct) {
            updateProduct(editingProduct.id, productData);
        }
        else {
            addProduct(productData);
        }
    };
    return (_jsxs("div", { className: "space-y-6 animate-in fade-in slide-in-from-bottom-4 duration-500", children: [_jsxs("div", { className: "flex flex-col sm:flex-row sm:items-center justify-between gap-4", children: [_jsxs("div", { children: [_jsx("h2", { className: "text-2xl font-bold text-foreground", style: { fontFamily: "Montserrat, sans-serif" }, children: "Gesti\u00F3n de Productos" }), _jsx("p", { className: "text-muted-foreground text-[14px]", style: { fontFamily: "Inter, sans-serif" }, children: "Administra el cat\u00E1logo, stock y precios de tus suministros." })] }), _jsxs("button", { onClick: handleOpenCreate, className: "flex items-center justify-center gap-2 bg-[#0a4d8c] text-white px-5 py-2.5 rounded-xl font-bold text-[14px] shadow-lg shadow-blue-500/20 hover:shadow-blue-500/40 active:scale-95 transition-all", style: { fontFamily: "Montserrat, sans-serif" }, children: [_jsx(Plus, { className: "w-5 h-5" }), "Nuevo Producto"] })] }), _jsxs("div", { className: "bg-white p-5 rounded-2xl border border-border shadow-sm space-y-4", children: [_jsxs("div", { className: "flex flex-col md:flex-row gap-4", children: [_jsxs("div", { className: "flex-1 relative group", children: [_jsx(Search, { className: "absolute left-3.5 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground group-focus-within:text-[#0a4d8c] transition-colors" }), _jsx("input", { type: "text", placeholder: "Buscar por nombre o SKU...", value: search, onChange: (e) => setSearch(e.target.value), className: "w-full pl-10 pr-4 py-2.5 bg-[#f5f7fa] border border-transparent rounded-xl text-[14px] focus:bg-white focus:border-[#0a4d8c] focus:ring-4 focus:ring-[#0a4d8c]/5 outline-none transition-all", style: { fontFamily: "Inter, sans-serif" } })] }), _jsxs("div", { className: "flex gap-2", children: [_jsxs("button", { onClick: () => setShowFilters(!showFilters), className: `flex items-center gap-2 px-4 py-2.5 rounded-xl text-[14px] font-semibold border transition-all ${showFilters ? "bg-[#0a4d8c] text-white border-[#0a4d8c]" : "bg-white text-foreground border-border hover:bg-[#f8f9fb]"}`, style: { fontFamily: "Inter, sans-serif" }, children: [_jsx(Filter, { className: "w-4 h-4" }), "Filtros"] }), _jsxs("button", { className: "flex items-center gap-2 px-4 py-2.5 rounded-xl text-[14px] font-semibold bg-white text-foreground border border-border hover:bg-[#f8f9fb] transition-all", style: { fontFamily: "Inter, sans-serif" }, children: [_jsx(Download, { className: "w-4 h-4" }), "Exportar"] })] })] }), showFilters && (_jsxs("div", { className: "grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 p-4 bg-[#f8f9fb] rounded-xl border border-border animate-in slide-in-from-top-2 duration-300", children: [_jsxs("div", { className: "space-y-1.5", children: [_jsx("label", { className: "text-[12px] font-bold text-muted-foreground ml-1", children: "Categor\u00EDa" }), _jsxs("select", { value: category, onChange: (e) => setCategory(e.target.value), className: "w-full bg-white border border-border rounded-lg px-3 py-2 text-[13px] outline-none focus:ring-2 focus:ring-[#0a4d8c]/20", children: [_jsx("option", { value: "all", children: "Todas las categor\u00EDas" }), categories.map(c => _jsx("option", { value: c.id, children: c.name }, c.id))] })] }), _jsxs("div", { className: "space-y-1.5", children: [_jsx("label", { className: "text-[12px] font-bold text-muted-foreground ml-1", children: "Estado de Stock" }), _jsxs("select", { value: stockStatus, onChange: (e) => setStockStatus(e.target.value), className: "w-full bg-white border border-border rounded-lg px-3 py-2 text-[13px] outline-none focus:ring-2 focus:ring-[#0a4d8c]/20", children: [_jsx("option", { value: "all", children: "Cualquier estado" }), _jsx("option", { value: "in-stock", children: "En Stock" }), _jsx("option", { value: "low-stock", children: "Bajo Stock" }), _jsx("option", { value: "out-of-stock", children: "Agotado" })] })] }), _jsxs("div", { className: "space-y-1.5", children: [_jsx("label", { className: "text-[12px] font-bold text-muted-foreground ml-1", children: "Visibilidad" }), _jsxs("select", { value: activeFilter, onChange: (e) => setActiveFilter(e.target.value), className: "w-full bg-white border border-border rounded-lg px-3 py-2 text-[13px] outline-none focus:ring-2 focus:ring-[#0a4d8c]/20", children: [_jsx("option", { value: "all", children: "Todos" }), _jsx("option", { value: "active", children: "Solo Activos" }), _jsx("option", { value: "inactive", children: "Solo Desactivados" })] })] })] }))] }), _jsxs("div", { className: "bg-white rounded-2xl border border-border shadow-sm overflow-hidden", children: [_jsx("div", { className: "overflow-x-auto", children: _jsxs("table", { className: "w-full text-left", style: { fontFamily: "Inter, sans-serif" }, children: [_jsx("thead", { children: _jsxs("tr", { className: "bg-[#f8f9fb] text-[12px] text-muted-foreground font-bold uppercase tracking-wider", children: [_jsx("th", { className: "px-6 py-4", children: "Producto" }), _jsx("th", { className: "px-6 py-4", children: "Categor\u00EDa" }), _jsx("th", { className: "px-6 py-4", children: "Precio" }), _jsx("th", { className: "px-6 py-4", children: "Stock" }), _jsx("th", { className: "px-6 py-4 text-center", children: "Estado" }), _jsx("th", { className: "px-6 py-4 text-right", children: "Acciones" })] }) }), _jsx("tbody", { className: "divide-y divide-border", children: currentProducts.map((p) => (_jsxs("tr", { className: "hover:bg-[#f8f9fb]/50 transition-colors group", children: [_jsx("td", { className: "px-6 py-4", children: _jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "w-12 h-12 rounded-lg bg-[#f8f9fb] border border-border p-1 overflow-hidden shrink-0", children: _jsx("img", { src: p.image, alt: p.name, className: "w-full h-full object-contain" }) }), _jsxs("div", { className: "min-w-0", children: [_jsx("p", { className: "text-[14px] font-bold text-foreground truncate max-w-[200px]", children: p.name }), _jsxs("p", { className: "text-[11px] text-muted-foreground font-medium", children: [p.sku, " \u00B7 ", p.brand] })] })] }) }), _jsx("td", { className: "px-6 py-4", children: _jsx("span", { className: "text-[13px] text-foreground font-medium capitalize", children: p.category }) }), _jsx("td", { className: "px-6 py-4", children: _jsxs("div", { className: "flex flex-col", children: [_jsx("span", { className: "text-[14px] font-bold text-[#0a4d8c]", children: formatPrice(p.price) }), _jsxs("span", { className: "text-[11px] text-muted-foreground", children: ["x ", p.unit] })] }) }), _jsx("td", { className: "px-6 py-4", children: _jsxs("div", { className: "flex items-center gap-2", children: [_jsx("span", { className: `w-2 h-2 rounded-full ${p.stockStatus === "in-stock" ? "bg-emerald-500" :
                                                                p.stockStatus === "low-stock" ? "bg-amber-500" : "bg-red-500"}` }), _jsx("span", { className: "text-[13px] font-bold text-foreground", children: p.stock })] }) }), _jsx("td", { className: "px-6 py-4 text-center", children: _jsx("span", { className: `inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-[11px] font-bold ${p.isActive !== false ? "bg-emerald-100 text-emerald-700" : "bg-slate-100 text-slate-600"}`, children: p.isActive !== false ? (_jsxs(_Fragment, { children: [_jsx(Eye, { className: "w-3 h-3" }), "Activo"] })) : (_jsxs(_Fragment, { children: [_jsx(EyeOff, { className: "w-3 h-3" }), "Oculto"] })) }) }), _jsx("td", { className: "px-6 py-4 text-right", children: _jsxs("div", { className: "flex items-center justify-end gap-1", children: [_jsx("button", { onClick: () => updateProduct(p.id, { isActive: !p.isActive }), className: `p-2 rounded-lg transition-colors ${p.isActive !== false ? "hover:bg-amber-50 text-amber-600" : "hover:bg-emerald-50 text-emerald-600"}`, title: p.isActive !== false ? "Desactivar" : "Activar", children: p.isActive !== false ? _jsx(EyeOff, { className: "w-4 h-4" }) : _jsx(Eye, { className: "w-4 h-4" }) }), _jsx("button", { onClick: () => handleOpenEdit(p), className: "p-2 hover:bg-blue-50 text-blue-600 rounded-lg transition-colors", title: "Editar", children: _jsx(Edit2, { className: "w-4 h-4" }) }), _jsx("button", { onClick: () => handleDelete(p.id, p.name), className: "p-2 hover:bg-red-50 text-red-500 rounded-lg transition-colors", title: "Eliminar", children: _jsx(Trash2, { className: "w-4 h-4" }) })] }) })] }, p.id))) })] }) }), totalPages > 1 && (_jsxs("div", { className: "px-6 py-4 bg-[#f8f9fb] border-t border-border flex items-center justify-between", children: [_jsxs("p", { className: "text-[13px] text-muted-foreground", children: ["Mostrando ", _jsx("span", { className: "font-bold text-foreground", children: currentProducts.length }), " de ", _jsx("span", { className: "font-bold text-foreground", children: filteredProducts.length }), " productos"] }), _jsxs("div", { className: "flex items-center gap-2", children: [_jsx("button", { onClick: () => setPage(prev => Math.max(1, prev - 1)), disabled: page === 1, className: "p-2 border border-border rounded-lg bg-white disabled:opacity-50 hover:bg-muted transition-colors", children: _jsx(ChevronLeft, { className: "w-4 h-4" }) }), _jsx("div", { className: "flex items-center gap-1", children: Array.from({ length: totalPages }, (_, i) => i + 1).map(n => (_jsx("button", { onClick: () => setPage(n), className: `w-8 h-8 rounded-lg text-[13px] font-bold transition-all ${page === n ? "bg-[#0a4d8c] text-white shadow-lg shadow-blue-500/20" : "hover:bg-muted text-foreground"}`, children: n }, n))) }), _jsx("button", { onClick: () => setPage(prev => Math.min(totalPages, prev + 1)), disabled: page === totalPages, className: "p-2 border border-border rounded-lg bg-white disabled:opacity-50 hover:bg-muted transition-colors", children: _jsx(ChevronRight, { className: "w-4 h-4" }) })] })] }))] }), _jsx(ProductModal, { isOpen: isModalOpen, onClose: () => setIsModalOpen(false), onSave: handleSave, product: editingProduct }), filteredProducts.length === 0 && (_jsxs("div", { className: "text-center py-20 bg-white rounded-2xl border border-dashed border-border", children: [_jsx(Package, { className: "w-12 h-12 text-muted-foreground mx-auto mb-4 opacity-30" }), _jsx("h3", { className: "text-lg font-bold text-foreground", style: { fontFamily: "Montserrat, sans-serif" }, children: "No se encontraron productos" }), _jsx("p", { className: "text-muted-foreground text-[14px] mt-1", style: { fontFamily: "Inter, sans-serif" }, children: "Intenta ajustar los filtros o t\u00E9rminos de b\u00FAsqueda." }), _jsx("button", { onClick: () => { setSearch(""); setCategory("all"); setStockStatus("all"); }, className: "mt-4 text-[13px] text-[#0a4d8c] font-bold hover:underline", children: "Limpiar filtros" })] }))] }));
}
